!function(e){"function"==typeof define&&define.amd?define("productForm",e):e()}(function(){"use strict";var i={template:"#product-form-date-picker",data(){return{picker:null,today:new Date,maxDate:new Date,value:null}},created(){this.value=this.$root.booking.checkIn?new Date(this.$root.booking.checkIn+" 00:00:00"):null,this.maxDate.setDate(this.maxDate.getDate()+this.$root.config.calendar.make_available_next)},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,defaultDate:this.value,minDate:this.today,maxDate:this.maxDate,onSelect:e=>{this.value=e},selectDayFn:e=>this.value&&this.value.toDateString()===e.toDateString(),disableDayFn:e=>{if(this.$root.excluded_weekday_indexes.includes(e.getDay()))return!0},unavailableDayFn:e=>{if(this.$root.config.calendar.excluded_days.includes(Voxel.helpers.dateFormatYmd(e)))return!0}})},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{refresh(){this.picker.draw()},reset(){this.value=null,this.refresh()}}},a={template:"#product-form-date-range-picker",data(){return{picker:null,today:new Date,maxDate:new Date,activePicker:"start",startDate:null,endDate:null,excludedDates:null,nextExcluded:null}},created(){this.startDate=this.$root.booking.checkIn?new Date(this.$root.booking.checkIn+" 00:00:00"):null,this.endDate=this.$root.booking.checkOut?new Date(this.$root.booking.checkOut+" 00:00:00"):null,this.maxDate.setDate(this.maxDate.getDate()+this.$root.config.calendar.make_available_next);var e=this.$root.config.calendar.excluded_days;this.excludedDates=e.map(e=>new Date(e)).sort((e,t)=>e-t)},mounted(){this.picker=new Pikaday({field:this.$refs.input,container:this.$refs.calendar,bound:!1,firstDay:1,keyboardInput:!1,numberOfMonths:2,defaultDate:this.startDate,minDate:this.today,maxDate:this.maxDate,theme:"pika-range",onSelect:e=>{"start"===this.activePicker?(this.setStartDate(e),this.activePicker="end"):this.setEndDate(e),this.refresh()},selectDayFn:e=>!(!this.startDate||e.toDateString()!==this.startDate.toDateString())||(!(!this.endDate||e.toDateString()!==this.endDate.toDateString())||void 0),disableDayFn:e=>!!this.$root.excluded_weekday_indexes.includes(e.getDay())||(!!("end"===this.activePicker&&this.startDate&&e<this.startDate)||(!!("end"===this.activePicker&&this.nextExcluded&&e>this.nextExcluded)||void 0)),unavailableDayFn:e=>{if(this.$root.config.calendar.excluded_days.includes(Voxel.helpers.dateFormatYmd(e)))return!0}}),this.setStartDate(this.startDate),this.setEndDate(this.endDate),this.refresh()},unmounted(){setTimeout(()=>this.picker.destroy(),200)},methods:{setStartDate(t){if(this.startDate=t,this.picker.setStartRange(t),this.nextExcluded=null,t){var e=this.excludedDates.find(e=>t<e),i=null;if(this.$root.excluded_weekday_indexes.length)for(var a=1;a<=6;a++)if((i=new Date(t.getTime())).setDate(i.getDate()+a),this.$root.excluded_weekday_indexes.includes(i.getDay()))break;this.nextExcluded=i&&i<e?i:e}this.endDate&&(this.startDate>this.endDate||this.endDate>this.nextExcluded)&&this.setEndDate(null)},setEndDate(e){this.endDate=e,this.picker.setEndRange(e)},refresh(){this.picker.draw()},reset(){this.setStartDate(null),this.setEndDate(null),this.refresh(),this.activePicker="start"}},computed:{startLabel(){return this.startDate?this.startDate.toLocaleDateString():this.$root.l10n.checkIn},endLabel(){return this.endDate?this.endDate.toLocaleDateString():this.$root.l10n.checkOut}},watch:{activePicker(){this.refresh()}}},s={template:"#create-post-media-popup",props:{multiple:{type:Boolean,default:!0},ignore:{type:Array,default:[]}},emits:["save","blur","open"],data(){return{page:1,files:[],selected:{},active:!1,loading:!0,hasMore:!1,firstLoad:!0}},methods:{getStyle(e){return e.type.startsWith("image/")?`background-image: url('${e.preview}');`:""},selectFile(e){this.selected[e.id]?delete this.selected[e.id]:this.selected[e.id]=e},loadMedia(){var e=Voxel_Config.ajax_url+"&action=list_media&page="+this.page;jQuery.get(e,e=>{this.loading=!1,e.files&&(this.files=this.files.concat(e.files)),this.hasMore=!!e.has_more})},loadMore(){this.loading=!0,this.page++,this.loadMedia()},openLibrary(){this.$emit("open"),this.firstLoad&&this.loadMedia(),this.firstLoad=!1,this.active=!this.active},isImage(e){return e.type.startsWith("image/")},save(){this.active=!1,this.$emit("save",this.selected),this.selected={}},clear(){this.selected={}}}},r={template:"#create-post-file-field",props:{field:Object,sortable:{type:Boolean,default:!0}},data(){return{accepts:""}},created(){null===this.field.value&&(this.field.value=[]),this.accepts=Object.values(this.field.props.allowedTypes).join(", ")},mounted(){this.updatePreviews(),jQuery(this.$refs.input).on("change",e=>{for(var t=0;t<e.target.files.length;t++){var i=e.target.files[t],a=URL.createObjectURL(i);this.field.value.push({source:"new_upload",name:i.name,type:i.type,preview:a,item:i})}this.$refs.input.value="",this.updatePreviews()}),jQuery(()=>{var e=jQuery(this.$refs.fileList);this.sortable&&(e.sortable({items:"> .ts-file",helper:"clone",appendTo:this.$el,containment:"parent",tolerance:"intersect",revert:150}),e.on("sortupdate",()=>{var i=[];e.find(".ts-file").each((e,t)=>{i.push(this.field.value[t.dataset.index])}),this.field.value=i,this.updatePreviews()})),e.find(".pick-file-input").on("click",e=>{e.preventDefault(),this.$refs.input.click()})})},unmounted(){setTimeout(()=>{Object.values(this.field.value).forEach(e=>{"new_upload"===e.source&&URL.revokeObjectURL(e.preview)})},10),this.sortable&&jQuery(this.$refs.fileList).sortable("destroy")},methods:{getStyle(e){return e.type.startsWith("image/")?`background-image: url('${e.preview}');`:""},updatePreviews(){var e=jQuery(this.$refs.fileList),a=[];this.field.value.forEach((e,t)=>{var i=e.type.startsWith("image/"),i=jQuery(`
					<div class="ts-file ${i?"ts-file-img":""}" style="${this.getStyle(e)}" data-index="${t}">
						<div class="ts-file-info">
							<i class="las la-cloud-upload-alt"></i><code></code>
						</div>
						<a href="#" class="ts-remove-file flexify"><i class="las la-times" aria-hidden="true"></i></a>
					</div>
				`);i.find("code").text(e.name),i.find("a").on("click",e=>{e.preventDefault(),this.field.value.splice(t,1),this.updatePreviews()}),a.push(i)}),e.find(".pick-file-input").siblings().remove(),e.append(a)},onMediaPopupSave(e){var t={};this.field.value.forEach(e=>{"existing"===e.source&&(t[e.id]=!0)}),Object.values(e).forEach(e=>{t[e.id]||this.field.value.push(e)}),this.updatePreviews()},onSubmit(t,i){var a=`files[${this.field.id}][]`;t[this.field.key]=[],this.field.value.forEach(e=>{"new_upload"===e.source?(i.append(a,e.item),t[this.field.key].push("uploaded_file")):"existing"===e.source&&t[this.field.key].push(e.id)})}}};window.render_product_form=()=>{Array.from(document.querySelectorAll(".ts-booking-form")).forEach(e=>{var t;e.__vue_app__||((t=Vue.createApp({el:e,mixins:[Voxel.mixins.base],data(){return{loading:!1,step:"main",activePopup:null,config:{},l10n:{},booking:{checkIn:null,checkOut:null,timeslot:null},additions:{},weekday_indexes:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},weekday_indexes_reverted:{0:"sun",1:"mon",2:"tue",3:"wed",4:"thu",5:"fri",6:"sat"},excluded_weekday_indexes:[]}},created(){this.config=jQuery.extend(!0,this.config,JSON.parse(this.$options.el.dataset.config)),this.l10n=jQuery.extend(!0,this.l10n,JSON.parse(this.$options.el.dataset.l10n)),this.additions=this.config.additions,this.config.calendar.excluded_weekdays.forEach(e=>{this.excluded_weekday_indexes.push(this.weekday_indexes[e])})},methods:{saveDateRange(){var e=this.$refs.picker;e.startDate?(this.booking.checkIn=e.startDate?Voxel.helpers.dateFormatYmd(e.startDate):null,this.booking.checkOut=e.endDate?Voxel.helpers.dateFormatYmd(e.endDate):e.startDate):(this.booking.checkIn=null,this.booking.checkOut=null),this.$refs.datePicker.$refs.popup.$emit("blur")},saveSingleDate(){this.booking.checkIn=this.$refs.picker.value?Voxel.helpers.dateFormatYmd(this.$refs.picker.value):null,this.booking.timeslot=null,this.$refs.datePicker.$refs.popup.$emit("blur")},resetPicker(){this.$refs.picker.reset()},increment(e){"number"!=typeof e.value||e.value+1<e.min_units?e.value=e.min_units:e.value=Math.min(e.value+1,e.max_units)},decrement(e){var t;"number"!=typeof e.value?e.value=e.min_units:(t=e.value-1,!e.required&&t<e.min_units?e.value=0:e.value=Math.max(t,e.min_units))},validateValueInBounds(e){"number"==typeof e.value&&(e.value>e.max_units?e.value=e.max_units:e.value<e.min_units&&(!e.required&&0===e.value||(e.value=e.min_units)))},prepareCheckout(){this.config.is_user_logged_in?Object.keys(this.additions).length?this.step="checkout":this.submit():window.location.href=this.config.auth_url},submit(){this.loading=!0;var i=new FormData,a={},t={},e=(Object.values(this.config.fields).forEach(e=>{var t=this.$refs["field:"+e.key];t&&"function"==typeof t.onSubmit?t.onSubmit(a,i):null!==e.value&&(a[e.key]=e.value)}),Object.values(this.additions).forEach(e=>{null!==e.value&&(t[e.key]=e.value)}),i.append("fields",JSON.stringify(a)),i.append("additions",JSON.stringify(t)),i.append("booking",JSON.stringify(this.booking)),jQuery.param({action:"checkout",post_id:this.$options.el.dataset.postId,field_key:this.$options.el.dataset.fieldKey}));jQuery.post({url:Voxel_Config.ajax_url+"&"+e,data:i,contentType:!1,processData:!1}).always(e=>{this.loading=!1,e.success?window.location.replace(e.redirect_url):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}},computed:{repeatDayCount(){var e=this.config.calendar;if("booking"!==e.type||"days"!==e.format||!e.allow_range)return 1;let t=this.booking.checkIn?new Date(this.booking.checkIn):null,i=this.booking.checkOut?new Date(this.booking.checkOut):null;if(!t||!i)return 0;var e=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),a=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return Math.abs(Math.floor((a-e)/864e5))+1},checkInLabel(){return this.booking.checkIn?new Date(this.booking.checkIn).toLocaleDateString():this.l10n.checkIn},checkOutLabel(){return this.booking.checkOut?new Date(this.booking.checkOut).toLocaleDateString():this.l10n.checkOut},pickDateLabel(){return this.booking.checkIn?new Date(this.booking.checkIn).toLocaleDateString():this.l10n.pickDate},pricing(){let s=this.repeatDayCount;var e=this.config.base_price*s;let r=e,n=[];return Object.values(this.additions).forEach(t=>{if("numeric"===t.type){if(0<t.value){var i=t.value*t.price;let e=i;t.repeat&&(e*=s),r+=e,n.push({label:t.label+" x "+t.value,price:e,price_per_day:i,repeat:t.repeat})}}else if("checkbox"===t.type){if(t.value){i=t.price;let e=i;t.repeat&&(e*=s),r+=e,n.push({label:t.label,price:e,price_per_day:i,repeat:t.repeat})}}else if("select"===t.type&&t.value){var i=t.choices[t.value],a=i.price;let e=a;t.repeat&&(e*=s),r+=e,n.push({label:t.label+": "+i.label,price:e,price_per_day:a,repeat:t.repeat})}}),{base_price:e,additions:n,total:r}},timeslots(){var e=this.booking.checkIn;if(!e)return!1;var t=this.weekday_indexes_reverted[e.getDay()],e=this.config.calendar.timeslots.find(e=>e.days.includes(t));return!!e&&e.slots}}})).component("form-popup",Voxel.components.popup),t.component("form-group",Voxel.components.formGroup),t.component("date-picker",i),t.component("date-range-picker",a),t.component("field-text",{template:"#product-form-text-field",props:{field:Object}}),t.component("field-number",{template:"#product-form-number-field",props:{field:Object}}),t.component("field-phone",{template:"#product-form-phone-field",props:{field:Object}}),t.component("field-url",{template:"#product-form-url-field",props:{field:Object}}),t.component("field-email",{template:"#product-form-email-field",props:{field:Object}}),t.component("field-textarea",{template:"#product-form-textarea-field",props:{field:Object}}),t.component("field-switcher",{template:"#product-form-switcher-field",props:{field:Object},data(){return{switcherId:"_switch-"+this.field.key}}}),r.template="#product-form-file-field",t.component("media-popup",s),t.component("field-file",r),t.mount(e))})},window.render_product_form()});
